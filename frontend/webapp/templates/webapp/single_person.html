{% extends "webapp/base.html" %}

{% block title %}{{ person.name|default:"Person" }}{% endblock %}

{% block header_extras %}
    
        <a href="{% url 'session-details' session_pk=session.id %}" class="nav-button">Receipt</a>
        <a href="{% url 'add-item' session_pk=session.id person_pk=person.id %}" class="nav-button">Add Item</a>
        <a href="{% url 'add-person' session_pk=session.id %}" class="nav-button">Add Person</a>
    
{% endblock %}

{% block content %}
{# {% include 'webapp/session_navbar.html' %} #}

<div id="person-details">

    <h2>
        {% if session and session.id %}
            <a href="{% url 'alter-user' session_pk=session.id person_pk=person.id %}" class="person-link">
                {{ person.name }}
            </a>
        {% else %}
            {{ person.name }}
        {% endif %}
    </h2>

    <table id="items-table">
        <thead>
            <tr>
                <th>Item</th>
                <th>Qty</th>
                <th>Price</th>
                <th>Total</th>
            </tr>
        </thead>

        <tbody>
            {# Option A: items are a list of dicts, not a queryset person.items.all #}
            {% for item in person.items %}
            <tr>
                <td>
                    {% if session_pk %}
                        <a href="{% url 'alter-item' session_pk=session.id person_pk=person.id item_pk=item.id %}" class="item-link">
                            {{ item.name }}
                        </a>
                    {% elif session and session.id %}
                        <a href="{% url 'alter-item' session_pk=session.id person_pk=person.id item_pk=item.id %}" class="item-link">
                            {{ item.name }}
                        </a>
                    {% else %}
                        {{ item.name }}
                    {% endif %}
                </td>
                <td>{{ item.quantity|default:1 }}</td>
                <td>{{ item.price }}</td>
                <td>
                    {# If backend doesn't send per-item total, compute in backend later; show fallback #}
                    {{ item.total|default:"—" }}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" class="muted-text">No items yet.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <p id="person-total">
        {# person.calculate_amount was a model method; now dict-based. Use totals if provided. #}
        Total:
        <strong>
            {{ person.total|default:"—" }}
        </strong>
    </p>
</div>
{% endblock %}
