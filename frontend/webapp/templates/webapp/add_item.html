{% extends "webapp/base.html" %}

{% block title %}Add Item{% endblock %}

{% block content %}
<div id="add-item-container">
    <h2>
        Add Item
        {% if name %}<span class="muted-text">for {{ name }}</span>{% endif %}
    </h2>

    {# Show non-field errors (e.g., backend validation/network errors) #}
    {% if form.non_field_errors %}
        <div class="form-error">
            {{ form.non_field_errors|striptags }}
        </div>
    {% endif %}

    <form method="POST" id="add-item-form" novalidate>
        {% csrf_token %}

        <div class="form-group">
            <label for="{{ form.name.id_for_label }}">Item Name:</label>
            {{ form.name }}
            {% if form.name.errors %}
                <div class="field-error">{{ form.name.errors|striptags }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="{{ form.quantity.id_for_label }}">Quantity:</label>
            {{ form.quantity }}
            {% if form.quantity.errors %}
                <div class="field-error">{{ form.quantity.errors|striptags }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="{{ form.price.id_for_label }}">Price:</label>
            {{ form.price }}
            {% if form.price.errors %}
                <div class="field-error">{{ form.price.errors|striptags }}</div>
            {% endif %}
        </div>

        <div class="edit-actions">
            <button type="submit" class="form-button">Add Item</button>

            {# Cancel should go back safely without relying on ORM relations #}
            {% if session_pk and person_pk %}
                <a href="{% url 'person-details' session_pk=session_pk person_pk=person_pk %}" class="btn-cancel">
                    Cancel
                </a>
            {% elif session_pk %}
                <a href="{% url 'session-details' session_pk=session_pk %}" class="btn-cancel">
                    Cancel
                </a>
            {% else %}
                <a href="{% url 'all-sessions' %}" class="btn-cancel">
                    Cancel
                </a>
            {% endif %}
        </div>
    </form>
</div>
{% endblock %}
